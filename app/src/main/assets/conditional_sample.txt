# Sample Auto Clicker Command File with Functions, Goto, Log Commands, and Image Detection
# Demonstrates functions, labels, goto, conditional jumps, logging, and image detection

# Define a function for clicking at different positions
fun clickSequence
    logs Performing click sequence
    click 500 800
    delay 500
    click 300 600
    delay 500
    click 700 400
    delay 500
    logs Click sequence completed
endfun

# Define a function for waiting
fun waitAndLog
    logs Waiting...
    delay 2000
    logs Wait completed
endfun

# Define a function for image detection
fun findButtonAndClick
    logs Looking for button image...
    findImagePosition /sdcard/Download/btn.png buttonX buttonY buttonConfidence
    logvar buttonX
    logvar buttonY
    logvar buttonConfidence
    
    # Check if image was found
    if $buttonX != -1
        logs Button found! Clicking at position
        click $buttonX $buttonY
        delay 500
    else
        logs Button not found, using fallback position
        click 500 800
        delay 500
    endif
endfun

# Set initial variables
set counter 0
set max_attempts 5
set status retry

# Start sequence
log Starting automation sequence
logs Automation sequence started!

# Try image detection first
call findButtonAndClick
delay 1000

# Continue with regular sequence
call clickSequence
call waitAndLog
delay 1000

# Label for retry loop
label retry_loop

# Increment counter
set counter $counter + 1
logvar counter
log Attempt number $counter
delay 500

# Click at different locations based on counter
if $counter == 1
    log Performing first attempt click
    click 300 600
    delay 500
endif

if $counter == 2
    log Performing second attempt click
    click 400 700
    delay 500
endif

if $counter == 3
    log Performing third attempt click
    click 600 500
    delay 500
endif

# Try image detection on attempt 4
if $counter == 4
    log Attempting image detection on fourth try
    findImagePosition /sdcard/Download/btn.png targetX targetY
    if $targetX != -1
        logs Image found! Clicking detected position
        click $targetX $targetY
    else
        logs Image not found, using default position
        click 500 500
    endif
    delay 500
endif

# Check if we should continue or stop
if $counter >= $max_attempts
    log Maximum attempts reached, ending sequence
    logs Maximum attempts reached!
    goto end_sequence
endif

# Wait and retry
log Waiting before retry
call waitAndLog
goto retry_loop

# End sequence label
label end_sequence

# Final actions
log Performing final actions
delay 1000
click 500 300
logvar status
delay 1000

# Conditional goto example
set status success
log Status changed to success
gotoif $status == success final_click

# This won't execute because status is success
log This should not appear
click 100 100

# Final click label
label final_click
log Performing final click
click 700 400
delay 1000

# Stop the sequence
log Automation sequence completed
logs Automation completed successfully!
stop